<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Help Desk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .ticket-card, .auth-view { animation: fadeIn 0.5s ease-out forwards; }
        .details-panel { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-12">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-10">
            <header class="text-center mb-8">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Student Help Desk</h1>
                    <button id="sign-out-btn" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Sign Out</button>
                </div>
                <p class="text-gray-500 mt-2">Submit a query or check ticket status.</p>
                <div id="user-info" class="mt-4 text-sm text-gray-600 font-medium">Please sign in to continue.</div>
            </header>

            <div id="login-view" class="auth-view">
                <div class="max-w-md mx-auto">
                    <div class="mb-4 flex border-b">
                        <button id="show-signin-btn" class="flex-1 py-2 text-center font-semibold text-indigo-600 border-b-2 border-indigo-600">Sign In</button>
                        <button id="show-signup-btn" class="flex-1 py-2 text-center font-semibold text-gray-500">Sign Up</button>
                    </div>
                    <div id="auth-error" class="hidden text-red-500 text-center p-2 mb-4 rounded-md bg-red-50 border border-red-200"></div>
                    
                    <form id="signin-form" class="space-y-4">
                        <input type="email" id="signin-email" placeholder="Email" required class="w-full px-3 py-2 border rounded-md">
                        <input type="password" id="signin-password" placeholder="Password" required class="w-full px-3 py-2 border rounded-md">
                        <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-md">Sign In</button>
                    </form>

                    <form id="signup-form" class="hidden space-y-4">
                        <input type="text" id="signup-name" placeholder="Full Name" required class="w-full px-3 py-2 border rounded-md">
                        <input type="email" id="signup-email" placeholder="Email" required class="w-full px-3 py-2 border rounded-md">
                        <input type="password" id="signup-password" placeholder="Password (min 6 chars)" required class="w-full px-3 py-2 border rounded-md">
                        <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-md">Create Account</button>
                    </form>
                </div>
            </div>

            <div id="main-content" class="hidden">
                <section class="mb-10">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Submit a New Ticket</h2>
                    <form id="ticket-form" class="space-y-4">
                        <textarea id="issue" rows="4" placeholder="Describe your issue..." required class="w-full px-3 py-2 border rounded-md"></textarea>
                        <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-md">Submit Ticket</button>
                    </form>
                </section>
                <section>
                    <h2 id="tickets-header" class="text-2xl font-semibold mb-4 border-b pb-2">Your Tickets</h2>
                    <div id="tickets-list" class="space-y-4"></div>
                </section>
            </div>
        </div>
    </div>
    <script type="module">
  // 1. Firebase Modules Import
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, onSnapshot, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  // 2. Aapka Provided Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCjE95eqnx1hGFpMAMG2mIXlS574eZn_bI",
    authDomain: "student-help-desk-5427b.firebaseapp.com",
    projectId: "student-help-desk-5427b",
    storageBucket: "student-help-desk-5427b.firebasestorage.app",
    messagingSenderId: "347315337821",
    appId: "1:347315337821:web:8b6f792dcd683b39c7ebb4",
    measurementId: "G-0XWX2FDHW5"
  };

  // Initialize Firebase Services
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // --- UI Elements ---
  const loginView = document.getElementById('login-view');
  const mainContent = document.getElementById('main-content');
  const signOutBtn = document.getElementById('sign-out-btn');
  const userInfo = document.getElementById('user-info');
  const authError = document.getElementById('auth-error');

  // --- Authentication Logic ---

  // Check if user is logged in
  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginView.classList.add('hidden');
      mainContent.classList.remove('hidden');
      signOutBtn.classList.remove('hidden');
      userInfo.innerText = `Welcome, ${user.displayName || user.email}`;
      loadTickets(user.uid);
    } else {
      loginView.classList.remove('hidden');
      mainContent.classList.add('hidden');
      signOutBtn.classList.add('hidden');
      userInfo.innerText = "Please sign in to continue.";
    }
  });

  // Sign Up Function
  document.getElementById('signup-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('signup-name').value;
    const email = document.getElementById('signup-email').value;
    const pass = document.getElementById('signup-password').value;
    authError.classList.add('hidden');
    
    try {
      const res = await createUserWithEmailAndPassword(auth, email, pass);
      await updateProfile(res.user, { displayName: name });
    } catch (err) {
      authError.innerText = "Error: " + err.message;
      authError.classList.remove('hidden');
    }
  });

  // Sign In Function
  document.getElementById('signin-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('signin-email').value;
    const pass = document.getElementById('signin-password').value;
    authError.classList.add('hidden');

    try {
      await signInWithEmailAndPassword(auth, email, pass);
    } catch (err) {
      authError.innerText = "Invalid login details.";
      authError.classList.remove('hidden');
    }
  });

  // Sign Out Function
  signOutBtn.addEventListener('click', () => signOut(auth));

  // --- Firestore Ticket Logic ---

  // Add a new Ticket
  document.getElementById('ticket-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const issueText = document.getElementById('issue').value;
    try {
      await addDoc(collection(db, "tickets"), {
        userId: auth.currentUser.uid,
        issue: issueText,
        status: "Open",
        timestamp: serverTimestamp()
      });
      document.getElementById('issue').value = "";
      alert("Ticket Raised Successfully!");
    } catch (err) {
      console.error(err);
      alert("Failed to submit ticket.");
    }
  });

  // Load User's Tickets
  function loadTickets(uid) {
    const q = query(collection(db, "tickets"), where("userId", "==", uid), orderBy("timestamp", "desc"));
    onSnapshot(q, (snapshot) => {
      const list = document.getElementById('tickets-list');
      list.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        list.innerHTML += `
          <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500 shadow-sm ticket-card">
            <p class="text-gray-800 font-medium">${data.issue}</p>
            <div class="flex justify-between mt-2 text-xs">
              <span class="text-indigo-600 font-bold uppercase">${data.status}</span>
              <span class="text-gray-400">${data.timestamp?.toDate().toLocaleString() || 'Syncing...'}</span>
            </div>
          </div>`;
      });
    });
  }

  // Toggle Forms
  document.getElementById('show-signup-btn').onclick = () => {
    document.getElementById('signup-form').classList.remove('hidden');
    document.getElementById('signin-form').classList.add('hidden');
    document.getElementById('show-signup-btn').className = "flex-1 py-2 text-center font-semibold text-indigo-600 border-b-2 border-indigo-600";
    document.getElementById('show-signin-btn').className = "flex-1 py-2 text-center font-semibold text-gray-500";
  };
  document.getElementById('show-signin-btn').onclick = () => {
    document.getElementById('signin-form').classList.remove('hidden');
    document.getElementById('signup-form').classList.add('hidden');
    document.getElementById('show-signin-btn').className = "flex-1 py-2 text-center font-semibold text-indigo-600 border-b-2 border-indigo-600";
    document.getElementById('show-signup-btn').className = "flex-1 py-2 text-center font-semibold text-gray-500";
  };
</script>
</body>


